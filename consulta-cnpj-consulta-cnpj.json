{
  "updatedAt": "2025-11-08T19:09:12.000Z",
  "createdAt": "2025-11-08T18:14:05.162Z",
  "id": "I9Z0SWGMVg2aE3Bz",
  "name": "consulta-cnpj",
  "active": false,
  "isArchived": true,
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.body.data.message.conversation }}",
        "options": {
          "systemMessage": "=Voc√™ √© um agente de IA respons√°vel por consultar informa√ß√µes de empresas a partir de um ou mais n√∫meros de CNPJ fornecidos pelo usu√°rio.  \nUtilize a API p√∫blica [OpenCNPJ](https://opencnpj.org) para buscar os dados e sempre retorne a resposta em formato exemplificado e formatado.\n\n---\n\n### Passo 1  \nOl√°! {{ $json.body.data.pushName }}üëã Sou seu assistente de consultas de CNPJ na Receita Federal.  \nPor favor, informe o CNPJ que deseja consultar. Aceito tanto n√∫meros puros quanto formatados, por exemplo:  \n\n- '00000000000000'  \n- '`'00.000.000/0000-00'\n\nPara consultar mais de um CNPJ, envie 1 de cada vez.\n\n---\n\n### Regras principais:\n\n1. **Valida√ß√£o de formato**  \n   - Cada CNPJ deve conter exatamente **14 d√≠gitos num√©ricos** ap√≥s remover qualquer pontua√ß√£o (pontos, barras, tra√ßos, espa√ßos).  \n   - Formatos aceitos:  \n     - `00000000000000` (somente n√∫meros)  \n     - `00.000.000/0000-00` (formatado)  \n   - Se algum CNPJ for inv√°lido (menos ou mais de 14 d√≠gitos), retorne para ele um objeto JSON de erro:  \n     ```json\n     {\n       \"erro\": \"CNPJ inv√°lido. Um CNPJ deve conter exatamente 14 d√≠gitos num√©ricos.\",\n       \"cnpj\": \"CNPJ_FORNECIDO\"\n     }\n     ```\n\n2. **Consulta na API**  \n   - Para cada CNPJ v√°lido, consulte os dados na API do OpenCNPJ.  \n   - Retorne apenas informa√ß√µes oficiais disponibilizadas pela API, no formato especificado abaixo.\n\n3. **Tratamento de erros**  \n   - Se o **CNPJ n√£o for encontrado**, retorne:  \n     ```json\n     {\n       \"erro\": \"CNPJ n√£o encontrado na base da Receita Federal.\",\n       \"cnpj\": \"CNPJ_FORNECIDO\"\n     }\n     ```  \n   - Se ocorrer **falha na API** (erro 500, 404, indisponibilidade), retorne:  \n     ```json\n     {\n       \"erro\": \"N√£o foi poss√≠vel consultar o CNPJ no momento. Tente novamente mais tarde.\",\n       \"cnpj\": \"CNPJ_FORNECIDO\"\n     }\n     ```  \n   - Nunca invente ou alucine dados.\n\n4. **Formato da resposta do payload**  \n \n   - Se for um √∫nico CNPJ v√°lido, retorne um objeto JSON.  \n   - Se forem m√∫ltiplos CNPJs, retorne um array de objetos JSON, cada um no formato abaixo.  \n   - Quando o CNPJ for encontrado, retorne no seguinte modelo:  \n     ```json\n     {\n       \"cnpj\": \"12345678000195\",\n       \"razao_social\": \"NOME DA EMPRESA LTDA\",\n       \"nome_fantasia\": \"NOME FANTASIA\",\n       \"atividade_principal\": \"Descri√ß√£o da atividade principal\",\n       \"atividades_secundarias\": [\n         \"Descri√ß√£o atividade 1\",\n         \"Descri√ß√£o atividade 2\"\n       ],\n       \"natureza_juridica\": \"Natureza jur√≠dica\",\n       \"endereco\": {\n         \"logradouro\": \"Rua Exemplo\",\n         \"numero\": \"123\",\n         \"complemento\": \"Sala 5\",\n         \"bairro\": \"Centro\",\n         \"cep\": \"00000000\",\n         \"municipio\": \"S√£o Paulo\",\n         \"uf\": \"SP\"\n       },\n       \"contato\": {\n         \"telefone\": \"(11) 0000-0000\",\n         \"email\": \"email@exemplo.com.br\"\n       },\n       \"situacao_cadastral\": \"ATIVA\"\n     }\n     ```\n\n---\n\nFormato da resposta que deve enviar ao usu√°rio:\n\nAqui est√£o as informa√ß√µes do CNPJ 38.292.673/0001-35:\n\n*Raz√£o Social:* FACEBOOK SERVICOS ONLINE DO BRASIL LTDA.  \n*Nome Fantasia:* (n√£o informado)  \n*Situa√ß√£o Cadastral:* Ativa desde 2011-02-14  \n*Matriz/Filial:* Matriz  \n*In√≠cio da Atividade:* 2011-02-14  \n*CNAE Principal:* 7312200  \n*Atividades Secund√°rias:*  \n- 7319004  \n- 7020400  \n*Natureza Jur√≠dica:* Sociedade Empres√°ria Limitada  \n*Endere√ßo:* BRIG FARIA LIMA, 3732, ANDAR 3AO7 8ALASUL 9 E 10, Bairro ITAIM BIBI, SAO PAULO - SP, CEP 04538132  \n*Email:* TAXCOMPLIANCEBR@FB.COM  \n*Telefone*: (11) 30736800  \n*Capital Social:* R$ 3.631.639,00  \n*Porte da Empresa:* Demais  \n*Op√ß√£o pelo Simples Nacional:* N√£o informado  \n*Op√ß√£o MEI:* N√£o informado  \n*S√≥cios:*   \n- Nome: FACEBOOK MIAMI, INC., Qualifica√ß√£o: S√≥cio Pessoa Jur√≠dica Domiciliado no Exterior, Entrada na Sociedade: 2015-09-17, Pessoa Jur√≠dica  \n- Nome: CONRADO LEISTER, Qualifica√ß√£o: Administrador, Entrada na Sociedade: 2018-11-14, Pessoa F√≠sica, Faixa Et√°ria: 41 a 50 anos\n\n### Instru√ß√µes finais:  \n- Seja tolerante a diferentes formatos de entrada de CNPJ, desde que respeitem os 14 d√≠gitos num√©ricos.  \n- Para m√∫ltiplos CNPJs, mantenha a ordem da entrada na resposta.  \n- N√£o inclua explica√ß√µes ou mensagens fora do contexto.  \n- Nunca gere dados fict√≠cios ou n√£o confirmados pela API.\n```"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        528,
        80
      ],
      "id": "b478b2f1-5669-490c-aa2e-3b7fbc236ad2",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "deepseek-chat",
          "mode": "list",
          "cachedResultName": "deepseek-chat"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        368,
        288
      ],
      "id": "86a9cb5e-8952-4b14-b1f8-077c476cd044",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "JsVRY04eH3ehOMOf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.body.data.key.remoteJid }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        528,
        288
      ],
      "id": "a37d8a39-b99c-4816-86be-4f3d35c78a9e",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "toolDescription": "a url para consulta do CNPJ √© https://api.opencnpj.org/\nvoc√™ deve inserir o cnpj logo ap√≥s a /\n",
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', `Exemplo:\n\"https://api.opencnpj.org/38.292.673/0001-35\"`, 'string') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        672,
        288
      ],
      "id": "59a84c50-1253-4fec-8cb5-2f82a57bccd0",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "consulta-cnpj",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        48,
        80
      ],
      "id": "f392b32a-d562-4dde-89f1-05b0ed90463f",
      "name": "Webhook",
      "webhookId": "5cb8b464-7381-482e-b181-4298cf543601"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        1168,
        80
      ],
      "id": "441626e0-f886-4da1-a7a3-0aced47dab46",
      "name": "Enviar texto",
      "credentials": {}
    },
    {
      "parameters": {
        "content": "## Trigger & AI Agent\n\n**When chat message received**:\n- Aciona o fluxo quando uma mensagem do usu√°rio √© recebida.\n\n**AI Agent**:\n- Orquestra o fluxo de conversa√ß√£o.\n- Recebe input do gatilho e usa modelos, mem√≥ria e ferramentas.",
        "height": 216,
        "width": 680,
        "color": 4
      },
      "name": "Note: Trigger + Agent",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        304,
        448
      ],
      "id": "e357d6a1-7467-431a-af8e-219e030d4aee",
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Processamento de Dados\n\n**OpenAI Chat Model**:\n- Executa chamadas ao modelo GPT para gerar respostas.\n\n**Simple Memory**:\n- Armazena o contexto das √∫ltimas intera√ß√µes para manter o hist√≥rico.\n\n**HTTP Request**:\n- Consulta a API OpenCNPJ para obter dados de CNPJ.\n\n\n**Append row in sheet in Google Sheets**:\n- Grava a consulta na planilha google sheet.",
        "height": 704,
        "width": 680,
        "color": 4
      },
      "name": "Note: Modelo, Mem√≥ria & HTTP",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        304,
        -272
      ],
      "id": "6cc97007-9413-4e26-b7c1-f908104f3ab4",
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Webhook Trigger Node\n\n- Recebe mensagens de chat via webhook.\n- Ponto de entrada do workflow.\n- Exposi√ß√£o do endpoint usado pelo node ‚ÄúWhen chat message received‚Äù.\n- Inicia o agente de IA para processar a entrada.",
        "height": 372,
        "width": 460
      },
      "name": "Webhook Explanation",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -176,
        -144
      ],
      "id": "ad4dfe2b-629d-47b1-ac67-9e9feabaee79",
      "typeVersion": 1
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "15zvnX5gWCzowoj_MmJp61EsWr3uk6vY__Z9yT0M5TFU",
          "mode": "list",
          "cachedResultName": "Busca CNPJ",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15zvnX5gWCzowoj_MmJp61EsWr3uk6vY__Z9yT0M5TFU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "P√°gina1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15zvnX5gWCzowoj_MmJp61EsWr3uk6vY__Z9yT0M5TFU/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "CNPJ": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('CNPJ', ``, 'string') }}",
            "Dados": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Dados', `Insira todos os dados da consulta do CNPJ\nDados de exemplo:\nRaz√£o Social: FACEBOOK SERVICOS ONLINE DO BRASIL LTDA.  \nNome Fantasia: (n√£o informado)  \nSitua√ß√£o Cadastral: Ativa desde 2011-02-14  \nMatriz/Filial: Matriz  \nIn√≠cio da Atividade: 2011-02-14  \nCNAE Principal: 7312200  \nAtividades Secund√°rias:  \n- 7319004  \n- 7020400  \nNatureza Jur√≠dica: Sociedade Empres√°ria Limitada  \nEndere√ßo: BRIG FARIA LIMA, 3732, ANDAR 3AO7 8ALASUL 9 E 10, Bairro ITAIM BIBI, SAO PAULO - SP, CEP 04538132  \nEmail: TAXCOMPLIANCEBR@FB.COM  \nTelefone: (11) 30736800  \nCapital Social: R$ 3.631.639,00  \nPorte da Empresa: Demais  \nOp√ß√£o pelo Simples Nacional: N√£o informado  \nOp√ß√£o MEI: N√£o informado  \nS√≥cios:   \n- Nome: FACEBOOK MIAMI, INC., Qualifica√ß√£o: S√≥cio Pessoa Jur√≠dica Domiciliado no Exterior, Entrada na Sociedade: 2015-09-17, Pessoa Jur√≠dica  \n- Nome: CONRADO LEISTER, Qualifica√ß√£o: Administrador, Entrada na Sociedade: 2018-11-14, Pessoa F√≠sica, Faixa Et√°ria: 41 a 50 anos\n\nExemplo:`, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "CNPJ",
              "displayName": "CNPJ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Dados",
              "displayName": "Dados",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        832,
        272
      ],
      "id": "c0a4379e-3ba9-4679-b241-1763e29b91ea",
      "name": "Append row in sheet in Google Sheets"
    },
    {
      "parameters": {
        "content": "## RESPONDE WHATSAPP",
        "height": 216,
        "width": 392,
        "color": 5
      },
      "name": "Note: Trigger + Agent1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        992,
        16
      ],
      "id": "65a1632d-1477-46b6-bc83-f7621dfeb285",
      "typeVersion": 1
    }
  ],
  "connections": {
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Enviar texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet in Google Sheets": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "Webhook": [
      {
        "json": {
          "headers": {
            "host": "ipaas.ian8n.com.br",
            "user-agent": "axios/1.10.0",
            "content-length": "1028",
            "accept": "application/json, text/plain, */*",
            "accept-encoding": "gzip, br",
            "cdn-loop": "cloudflare; loops=1",
            "cf-connecting-ip": "92.112.179.86",
            "cf-ipcountry": "BR",
            "cf-ray": "980b6cb97f286292-GRU",
            "cf-visitor": "{\"scheme\":\"https\"}",
            "content-type": "application/json",
            "x-forwarded-for": "92.112.179.86, 172.69.114.92",
            "x-forwarded-host": "ipaas.ian8n.com.br",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "5ab2a0568e03",
            "x-real-ip": "172.69.114.92"
          },
          "params": {},
          "query": {},
          "body": {
            "event": "messages.upsert",
            "instance": "consulta-cnpj",
            "data": {
              "key": {
                "remoteJid": "554188470604@s.whatsapp.net",
                "fromMe": false,
                "id": "3EB0925414F1C6B881A644",
                "senderPn": "554188470604@s.whatsapp.net",
                "previousRemoteJid": "203328332009651@lid"
              },
              "pushName": "Koch",
              "status": "DELIVERY_ACK",
              "message": {
                "conversation": "oi",
                "messageContextInfo": {
                  "deviceListMetadata": {
                    "senderKeyHash": "xCS3QrvvnbTzOA==",
                    "senderTimestamp": "1758071722",
                    "senderAccountType": "E2EE",
                    "receiverAccountType": "E2EE",
                    "recipientKeyHash": "NYb2HBZBPGj+bg==",
                    "recipientTimestamp": "1758141641"
                  },
                  "deviceListMetadataVersion": 2,
                  "messageSecret": "mV10a2gCpYBmna3DLpBuhCqx5/qlogFd4WP2gB+o17U="
                }
              },
              "messageType": "conversation",
              "messageTimestamp": 1758141689,
              "instanceId": "9c5c1855-ac7d-4385-a11c-f7e7f3595e7e",
              "source": "web"
            },
            "destination": "https://ipaas.ian8n.com.br/webhook/consulta-cnpj",
            "date_time": "2025-09-17T17:41:29.798Z",
            "sender": "554196489481@s.whatsapp.net",
            "server_url": "https://apps-evolution-api.ufffth.easypanel.host",
            "apikey": "5F7BE3A3AC20-403A-BA21-4ADAEB5D9043"
          },
          "webhookUrl": "https://ipaas.ian8n.com.br/webhook/consulta-cnpj",
          "executionMode": "production"
        }
      }
    ]
  },
  "versionId": "2f5cee7d-f9c7-4ec9-bcb8-0d640adf3fe0",
  "triggerCount": 0,
  "shared": [
    {
      "updatedAt": "2025-11-08T18:14:05.166Z",
      "createdAt": "2025-11-08T18:14:05.166Z",
      "role": "workflow:owner",
      "workflowId": "I9Z0SWGMVg2aE3Bz",
      "projectId": "TlfmJa4WqVZC43Rf"
    }
  ],
  "tags": []
}